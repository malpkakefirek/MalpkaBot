"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = eslintHelp;

var _lodash = _interopRequireDefault(require("lodash"));

var _logger = _interopRequireDefault(require("../logger"));

var _cli = _interopRequireDefault(require("./cli"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const logger = (0, _logger.default)('eslint-help');
logger.debug('Loaded');
const namedOption = /^--/;

function parseNo(option, str) {
  if (!str) return;
  let cmd = str.replace('--', '');

  if (/no-/.test(cmd)) {
    logger.debug('Parsing no option', str);
    cmd = cmd.replace('no-', '');
    option.default = 'true';
  }

  option.option = cmd;
  return option;
}

function parseDouble(arr) {
  const description = _lodash.default.without(arr.slice(2), '').join(' ');

  return {
    option: arr[0].replace('--', ''),
    type: 'Boolean',
    alias: arr[1].replace('--', ''),
    description: description
  };
}

function parseRegular(arr) {
  logger.debug('Parsing %s', arr[0]);

  if (!arr[0]) {
    return;
  }

  const optionText = arr[0];
  const type = arr[1] || 'Boolean';
  const option = parseNo({}, optionText);

  const helpText = _lodash.default.without(arr, optionText, type, '');

  const description = helpText.join(' ');
  option.type = type;

  if (description) {
    option.description = description;
  }

  return option;
}

function parseAlias(arr) {
  const alias = arr[0];
  logger.debug('Alias found: %s', alias);
  const option = parseRegular(_lodash.default.without(arr, alias));

  if (alias) {
    option.alias = alias.replace('-', '');
  }

  return option;
}

function createOption(arr) {
  let option;

  if (namedOption.test(arr[0]) && namedOption.test(arr[1])) {
    // no alias defaulted boolean
    option = parseDouble(arr);
  } else if (namedOption.test(arr[0]) && !namedOption.test(arr[1])) {
    // just a no alias
    option = parseRegular(arr);
  } else {
    // aliased or other
    option = parseAlias(arr);
  }

  return _lodash.default.isEmpty(option) ? undefined : option;
}

function parseHelp(helpText) {
  let helpArr = helpText.split('\n');
  let previousLine = [];
  return _lodash.default.without(_lodash.default.map(helpArr, (row, index) => {
    if (index <= 2) {
      return;
    }

    let str = row.replace(',', '');
    let arr = str.trim().split(' ');

    if (str.indexOf('-') >= 0 && previousLine[0] !== '') {
      let option = createOption(arr);

      if (option && option.option !== 'format' && option.option !== 'help') {
        return option;
      }
    }

    previousLine = arr;
  }), undefined);
}

function eslintHelp() {
  logger.debug('Executing help');
  const result = (0, _cli.default)(['--help'], {
    stdio: [process.stdin, null, process.stderr]
  });

  if (!result.message) {
    throw new Error('Help text not received from Eslint.');
  }

  const eslintOptions = parseHelp(result.message);
  return eslintOptions;
}

module.exports = exports["default"];
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9lc2xpbnQvaGVscC5qcyJdLCJuYW1lcyI6WyJsb2dnZXIiLCJkZWJ1ZyIsIm5hbWVkT3B0aW9uIiwicGFyc2VObyIsIm9wdGlvbiIsInN0ciIsImNtZCIsInJlcGxhY2UiLCJ0ZXN0IiwiZGVmYXVsdCIsInBhcnNlRG91YmxlIiwiYXJyIiwiZGVzY3JpcHRpb24iLCJfIiwid2l0aG91dCIsInNsaWNlIiwiam9pbiIsInR5cGUiLCJhbGlhcyIsInBhcnNlUmVndWxhciIsIm9wdGlvblRleHQiLCJoZWxwVGV4dCIsInBhcnNlQWxpYXMiLCJjcmVhdGVPcHRpb24iLCJpc0VtcHR5IiwidW5kZWZpbmVkIiwicGFyc2VIZWxwIiwiaGVscEFyciIsInNwbGl0IiwicHJldmlvdXNMaW5lIiwibWFwIiwicm93IiwiaW5kZXgiLCJ0cmltIiwiaW5kZXhPZiIsImVzbGludEhlbHAiLCJyZXN1bHQiLCJzdGRpbyIsInByb2Nlc3MiLCJzdGRpbiIsInN0ZGVyciIsIm1lc3NhZ2UiLCJFcnJvciIsImVzbGludE9wdGlvbnMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFFQTs7QUFDQTs7OztBQUVBLE1BQU1BLFNBQVMscUJBQU8sYUFBUCxDQUFmO0FBQ0FBLE9BQU9DLEtBQVAsQ0FBYSxRQUFiO0FBRUEsTUFBTUMsY0FBYyxLQUFwQjs7QUFFQSxTQUFTQyxPQUFULENBQWlCQyxNQUFqQixFQUF5QkMsR0FBekIsRUFBOEI7QUFDNUIsTUFBSSxDQUFDQSxHQUFMLEVBQVU7QUFFVixNQUFJQyxNQUFNRCxJQUFJRSxPQUFKLENBQVksSUFBWixFQUFrQixFQUFsQixDQUFWOztBQUVBLE1BQUksTUFBTUMsSUFBTixDQUFXRixHQUFYLENBQUosRUFBcUI7QUFDbkJOLFdBQU9DLEtBQVAsQ0FBYSxtQkFBYixFQUFrQ0ksR0FBbEM7QUFDQUMsVUFBTUEsSUFBSUMsT0FBSixDQUFZLEtBQVosRUFBbUIsRUFBbkIsQ0FBTjtBQUNBSCxXQUFPSyxPQUFQLEdBQWlCLE1BQWpCO0FBQ0Q7O0FBRURMLFNBQU9BLE1BQVAsR0FBZ0JFLEdBQWhCO0FBRUEsU0FBT0YsTUFBUDtBQUNEOztBQUVELFNBQVNNLFdBQVQsQ0FBcUJDLEdBQXJCLEVBQTBCO0FBQ3hCLFFBQU1DLGNBQWNDLGdCQUFFQyxPQUFGLENBQVVILElBQUlJLEtBQUosQ0FBVSxDQUFWLENBQVYsRUFBd0IsRUFBeEIsRUFBNEJDLElBQTVCLENBQWlDLEdBQWpDLENBQXBCOztBQUVBLFNBQU87QUFDTFosWUFBUU8sSUFBSSxDQUFKLEVBQU9KLE9BQVAsQ0FBZSxJQUFmLEVBQXFCLEVBQXJCLENBREg7QUFFTFUsVUFBTSxTQUZEO0FBR0xDLFdBQU9QLElBQUksQ0FBSixFQUFPSixPQUFQLENBQWUsSUFBZixFQUFxQixFQUFyQixDQUhGO0FBSUxLLGlCQUFhQTtBQUpSLEdBQVA7QUFNRDs7QUFFRCxTQUFTTyxZQUFULENBQXNCUixHQUF0QixFQUEyQjtBQUN6QlgsU0FBT0MsS0FBUCxDQUFhLFlBQWIsRUFBMkJVLElBQUksQ0FBSixDQUEzQjs7QUFFQSxNQUFJLENBQUNBLElBQUksQ0FBSixDQUFMLEVBQWE7QUFDWDtBQUNEOztBQUVELFFBQU1TLGFBQWFULElBQUksQ0FBSixDQUFuQjtBQUNBLFFBQU1NLE9BQU9OLElBQUksQ0FBSixLQUFVLFNBQXZCO0FBQ0EsUUFBTVAsU0FBU0QsUUFBUSxFQUFSLEVBQVlpQixVQUFaLENBQWY7O0FBQ0EsUUFBTUMsV0FBV1IsZ0JBQUVDLE9BQUYsQ0FBVUgsR0FBVixFQUFlUyxVQUFmLEVBQTJCSCxJQUEzQixFQUFpQyxFQUFqQyxDQUFqQjs7QUFDQSxRQUFNTCxjQUFjUyxTQUFTTCxJQUFULENBQWMsR0FBZCxDQUFwQjtBQUVBWixTQUFPYSxJQUFQLEdBQWNBLElBQWQ7O0FBRUEsTUFBSUwsV0FBSixFQUFpQjtBQUNmUixXQUFPUSxXQUFQLEdBQXFCQSxXQUFyQjtBQUNEOztBQUVELFNBQU9SLE1BQVA7QUFDRDs7QUFFRCxTQUFTa0IsVUFBVCxDQUFvQlgsR0FBcEIsRUFBeUI7QUFDdkIsUUFBTU8sUUFBUVAsSUFBSSxDQUFKLENBQWQ7QUFDQVgsU0FBT0MsS0FBUCxDQUFhLGlCQUFiLEVBQWdDaUIsS0FBaEM7QUFDQSxRQUFNZCxTQUFTZSxhQUFhTixnQkFBRUMsT0FBRixDQUFVSCxHQUFWLEVBQWVPLEtBQWYsQ0FBYixDQUFmOztBQUVBLE1BQUlBLEtBQUosRUFBVztBQUNUZCxXQUFPYyxLQUFQLEdBQWVBLE1BQU1YLE9BQU4sQ0FBYyxHQUFkLEVBQW1CLEVBQW5CLENBQWY7QUFDRDs7QUFFRCxTQUFPSCxNQUFQO0FBQ0Q7O0FBRUQsU0FBU21CLFlBQVQsQ0FBc0JaLEdBQXRCLEVBQTJCO0FBQ3pCLE1BQUlQLE1BQUo7O0FBRUEsTUFBSUYsWUFBWU0sSUFBWixDQUFpQkcsSUFBSSxDQUFKLENBQWpCLEtBQTRCVCxZQUFZTSxJQUFaLENBQWlCRyxJQUFJLENBQUosQ0FBakIsQ0FBaEMsRUFBMEQ7QUFDeEQ7QUFDQVAsYUFBU00sWUFBWUMsR0FBWixDQUFUO0FBQ0QsR0FIRCxNQUdPLElBQUlULFlBQVlNLElBQVosQ0FBaUJHLElBQUksQ0FBSixDQUFqQixLQUE0QixDQUFDVCxZQUFZTSxJQUFaLENBQWlCRyxJQUFJLENBQUosQ0FBakIsQ0FBakMsRUFBMkQ7QUFDaEU7QUFDQVAsYUFBU2UsYUFBYVIsR0FBYixDQUFUO0FBQ0QsR0FITSxNQUdBO0FBQ0w7QUFDQVAsYUFBU2tCLFdBQVdYLEdBQVgsQ0FBVDtBQUNEOztBQUVELFNBQU9FLGdCQUFFVyxPQUFGLENBQVVwQixNQUFWLElBQW9CcUIsU0FBcEIsR0FBZ0NyQixNQUF2QztBQUNEOztBQUVELFNBQVNzQixTQUFULENBQW1CTCxRQUFuQixFQUE2QjtBQUMzQixNQUFJTSxVQUFVTixTQUFTTyxLQUFULENBQWUsSUFBZixDQUFkO0FBQ0EsTUFBSUMsZUFBZSxFQUFuQjtBQUVBLFNBQU9oQixnQkFBRUMsT0FBRixDQUNMRCxnQkFBRWlCLEdBQUYsQ0FBTUgsT0FBTixFQUFlLENBQUNJLEdBQUQsRUFBTUMsS0FBTixLQUFnQjtBQUM3QixRQUFJQSxTQUFTLENBQWIsRUFBZ0I7QUFDZDtBQUNEOztBQUNELFFBQUkzQixNQUFNMEIsSUFBSXhCLE9BQUosQ0FBWSxHQUFaLEVBQWlCLEVBQWpCLENBQVY7QUFDQSxRQUFJSSxNQUFNTixJQUFJNEIsSUFBSixHQUFXTCxLQUFYLENBQWlCLEdBQWpCLENBQVY7O0FBQ0EsUUFBSXZCLElBQUk2QixPQUFKLENBQVksR0FBWixLQUFvQixDQUFwQixJQUF5QkwsYUFBYSxDQUFiLE1BQW9CLEVBQWpELEVBQXFEO0FBQ25ELFVBQUl6QixTQUFTbUIsYUFBYVosR0FBYixDQUFiOztBQUNBLFVBQUlQLFVBQVVBLE9BQU9BLE1BQVAsS0FBa0IsUUFBNUIsSUFBd0NBLE9BQU9BLE1BQVAsS0FBa0IsTUFBOUQsRUFBc0U7QUFDcEUsZUFBT0EsTUFBUDtBQUNEO0FBQ0Y7O0FBQ0R5QixtQkFBZWxCLEdBQWY7QUFDRCxHQWJELENBREssRUFlTGMsU0FmSyxDQUFQO0FBaUJEOztBQUVjLFNBQVNVLFVBQVQsR0FBc0I7QUFDbkNuQyxTQUFPQyxLQUFQLENBQWEsZ0JBQWI7QUFDQSxRQUFNbUMsU0FBUyxrQkFBTyxDQUFDLFFBQUQsQ0FBUCxFQUFtQjtBQUFFQyxXQUFPLENBQUNDLFFBQVFDLEtBQVQsRUFBZ0IsSUFBaEIsRUFBc0JELFFBQVFFLE1BQTlCO0FBQVQsR0FBbkIsQ0FBZjs7QUFDQSxNQUFJLENBQUNKLE9BQU9LLE9BQVosRUFBcUI7QUFDbkIsVUFBTSxJQUFJQyxLQUFKLENBQVUscUNBQVYsQ0FBTjtBQUNEOztBQUNELFFBQU1DLGdCQUFnQmpCLFVBQVVVLE9BQU9LLE9BQWpCLENBQXRCO0FBQ0EsU0FBT0UsYUFBUDtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcblxuaW1wb3J0IExvZ2dlciBmcm9tICcuLi9sb2dnZXInO1xuaW1wb3J0IGVzbGludCBmcm9tICcuL2NsaSc7XG5cbmNvbnN0IGxvZ2dlciA9IExvZ2dlcignZXNsaW50LWhlbHAnKTtcbmxvZ2dlci5kZWJ1ZygnTG9hZGVkJyk7XG5cbmNvbnN0IG5hbWVkT3B0aW9uID0gL14tLS87XG5cbmZ1bmN0aW9uIHBhcnNlTm8ob3B0aW9uLCBzdHIpIHtcbiAgaWYgKCFzdHIpIHJldHVybjtcblxuICBsZXQgY21kID0gc3RyLnJlcGxhY2UoJy0tJywgJycpO1xuXG4gIGlmICgvbm8tLy50ZXN0KGNtZCkpIHtcbiAgICBsb2dnZXIuZGVidWcoJ1BhcnNpbmcgbm8gb3B0aW9uJywgc3RyKTtcbiAgICBjbWQgPSBjbWQucmVwbGFjZSgnbm8tJywgJycpO1xuICAgIG9wdGlvbi5kZWZhdWx0ID0gJ3RydWUnO1xuICB9XG5cbiAgb3B0aW9uLm9wdGlvbiA9IGNtZDtcblxuICByZXR1cm4gb3B0aW9uO1xufVxuXG5mdW5jdGlvbiBwYXJzZURvdWJsZShhcnIpIHtcbiAgY29uc3QgZGVzY3JpcHRpb24gPSBfLndpdGhvdXQoYXJyLnNsaWNlKDIpLCAnJykuam9pbignICcpO1xuXG4gIHJldHVybiB7XG4gICAgb3B0aW9uOiBhcnJbMF0ucmVwbGFjZSgnLS0nLCAnJyksXG4gICAgdHlwZTogJ0Jvb2xlYW4nLFxuICAgIGFsaWFzOiBhcnJbMV0ucmVwbGFjZSgnLS0nLCAnJyksXG4gICAgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uLFxuICB9O1xufVxuXG5mdW5jdGlvbiBwYXJzZVJlZ3VsYXIoYXJyKSB7XG4gIGxvZ2dlci5kZWJ1ZygnUGFyc2luZyAlcycsIGFyclswXSk7XG5cbiAgaWYgKCFhcnJbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBvcHRpb25UZXh0ID0gYXJyWzBdO1xuICBjb25zdCB0eXBlID0gYXJyWzFdIHx8ICdCb29sZWFuJztcbiAgY29uc3Qgb3B0aW9uID0gcGFyc2VObyh7fSwgb3B0aW9uVGV4dCk7XG4gIGNvbnN0IGhlbHBUZXh0ID0gXy53aXRob3V0KGFyciwgb3B0aW9uVGV4dCwgdHlwZSwgJycpO1xuICBjb25zdCBkZXNjcmlwdGlvbiA9IGhlbHBUZXh0LmpvaW4oJyAnKTtcblxuICBvcHRpb24udHlwZSA9IHR5cGU7XG5cbiAgaWYgKGRlc2NyaXB0aW9uKSB7XG4gICAgb3B0aW9uLmRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb247XG4gIH1cblxuICByZXR1cm4gb3B0aW9uO1xufVxuXG5mdW5jdGlvbiBwYXJzZUFsaWFzKGFycikge1xuICBjb25zdCBhbGlhcyA9IGFyclswXTtcbiAgbG9nZ2VyLmRlYnVnKCdBbGlhcyBmb3VuZDogJXMnLCBhbGlhcyk7XG4gIGNvbnN0IG9wdGlvbiA9IHBhcnNlUmVndWxhcihfLndpdGhvdXQoYXJyLCBhbGlhcykpO1xuXG4gIGlmIChhbGlhcykge1xuICAgIG9wdGlvbi5hbGlhcyA9IGFsaWFzLnJlcGxhY2UoJy0nLCAnJyk7XG4gIH1cblxuICByZXR1cm4gb3B0aW9uO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVPcHRpb24oYXJyKSB7XG4gIGxldCBvcHRpb247XG5cbiAgaWYgKG5hbWVkT3B0aW9uLnRlc3QoYXJyWzBdKSAmJiBuYW1lZE9wdGlvbi50ZXN0KGFyclsxXSkpIHtcbiAgICAvLyBubyBhbGlhcyBkZWZhdWx0ZWQgYm9vbGVhblxuICAgIG9wdGlvbiA9IHBhcnNlRG91YmxlKGFycik7XG4gIH0gZWxzZSBpZiAobmFtZWRPcHRpb24udGVzdChhcnJbMF0pICYmICFuYW1lZE9wdGlvbi50ZXN0KGFyclsxXSkpIHtcbiAgICAvLyBqdXN0IGEgbm8gYWxpYXNcbiAgICBvcHRpb24gPSBwYXJzZVJlZ3VsYXIoYXJyKTtcbiAgfSBlbHNlIHtcbiAgICAvLyBhbGlhc2VkIG9yIG90aGVyXG4gICAgb3B0aW9uID0gcGFyc2VBbGlhcyhhcnIpO1xuICB9XG5cbiAgcmV0dXJuIF8uaXNFbXB0eShvcHRpb24pID8gdW5kZWZpbmVkIDogb3B0aW9uO1xufVxuXG5mdW5jdGlvbiBwYXJzZUhlbHAoaGVscFRleHQpIHtcbiAgbGV0IGhlbHBBcnIgPSBoZWxwVGV4dC5zcGxpdCgnXFxuJyk7XG4gIGxldCBwcmV2aW91c0xpbmUgPSBbXTtcblxuICByZXR1cm4gXy53aXRob3V0KFxuICAgIF8ubWFwKGhlbHBBcnIsIChyb3csIGluZGV4KSA9PiB7XG4gICAgICBpZiAoaW5kZXggPD0gMikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBsZXQgc3RyID0gcm93LnJlcGxhY2UoJywnLCAnJyk7XG4gICAgICBsZXQgYXJyID0gc3RyLnRyaW0oKS5zcGxpdCgnICcpO1xuICAgICAgaWYgKHN0ci5pbmRleE9mKCctJykgPj0gMCAmJiBwcmV2aW91c0xpbmVbMF0gIT09ICcnKSB7XG4gICAgICAgIGxldCBvcHRpb24gPSBjcmVhdGVPcHRpb24oYXJyKTtcbiAgICAgICAgaWYgKG9wdGlvbiAmJiBvcHRpb24ub3B0aW9uICE9PSAnZm9ybWF0JyAmJiBvcHRpb24ub3B0aW9uICE9PSAnaGVscCcpIHtcbiAgICAgICAgICByZXR1cm4gb3B0aW9uO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBwcmV2aW91c0xpbmUgPSBhcnI7XG4gICAgfSksXG4gICAgdW5kZWZpbmVkXG4gICk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGVzbGludEhlbHAoKSB7XG4gIGxvZ2dlci5kZWJ1ZygnRXhlY3V0aW5nIGhlbHAnKTtcbiAgY29uc3QgcmVzdWx0ID0gZXNsaW50KFsnLS1oZWxwJ10sIHsgc3RkaW86IFtwcm9jZXNzLnN0ZGluLCBudWxsLCBwcm9jZXNzLnN0ZGVycl0gfSk7XG4gIGlmICghcmVzdWx0Lm1lc3NhZ2UpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0hlbHAgdGV4dCBub3QgcmVjZWl2ZWQgZnJvbSBFc2xpbnQuJyk7XG4gIH1cbiAgY29uc3QgZXNsaW50T3B0aW9ucyA9IHBhcnNlSGVscChyZXN1bHQubWVzc2FnZSk7XG4gIHJldHVybiBlc2xpbnRPcHRpb25zO1xufVxuIl19